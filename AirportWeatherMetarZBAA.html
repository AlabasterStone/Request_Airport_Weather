<!DOCTYPE html>

<head>
    <meta charset="UTF-8">
    <title>查询机场METAR</title>
</head>

<body>
    <p id="ReadText"></p>


    <script type="text/javascript">
        let RequestAirport = "ZBAA";

        let url = window.location.search;
        if (url != "") {
            url = url.substring(1);
            var datas = url.split('&');
            RequestAirport = datas[0].split('=')[1];
        }


        var Alltext = "";

        let jsonReading = {
            "0": "洞",
            "1": "腰",
            "2": "两",
            "3": "叁",
            "4": "四",
            "5": "五",
            "6": "六",
            "7": "拐",
            "8": "八",
            "9": "九",
            "A": "Alpha",
            "B": "Bravo",
            "C": "Charlie",
            "D": "Delta",
            "E": "Echo",
            "F": "Foxtrot",
            "G": "Golf",
            "H": "Hotel",
            "I": "India",
            "J": "Juliet",
            "K": "Kilo",
            "L": "Lima",
            "M": "Mike",
            "N": "November",
            "O": "Oscar",
            "P": "Papa",
            "Q": "Quebec",
            "R": "Romeo",
            "S": "Sierra",
            "T": "Tango",
            "U": "Uniform",
            "V": "Victor",
            "W": "Whiskey",
            "X": "X-ray",
            "Y": "Yankee",
            "Z": "Zulu",
            "-": "零下",
            "+": "洞 洞 洞"
        };

        let jsonweathercondition = {
            "-": "轻微的",
            "+": "重度的",
            "MI": "浅的",
            "BC": "散片状的",
            "PR": "一部分",
            "BL": "风吹",
            "DR": "飘动",
            "SH": "阵性的",
            "FZ": "冰冻",
            "VC": "机场附近",
            "TS": "雷暴"
        };

        let jsonweatherphen = {
            "DZ": "毛毛雨",
            "RA": "雨",
            "SN": "雪",
            "SG": "米雪",
            "IC": "冰针 或 冰晶",
            "PL": "冰粒",
            "PE": "冰粒",
            "GR": "冰雹",
            "GS": "小冰雹",
            "BR": "轻雾",
            "FG": "雾",
            "FU": "烟",
            "VA": "火山灰",
            "DU": "浮沉",
            "SA": "扬沙",
            "HZ": "霾",
            "PO": "发展完好的沙卷或尘卷",
            "SQ": "飑",
            "FC": "漏斗云 或 龙卷风",
            "SS": "沙暴",
            "DS": "尘暴"
        };


        function ajaxAPI(url, callback) {
            var xhr = new XMLHttpRequest();
            xhr.open('GET', url, true);
            xhr.setRequestHeader("Access-Control-Allow-Origin", "*");
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.onload = function () {
                callback(xhr.responseText);
            };
            xhr.send();
        }
        function UTCtoCST(utcDateString, callback) {
            utcDateString = utcDateString.replace(' ', 'T');
            const utcDate = new Date(utcDateString);
            const beijingDate = new Date(utcDate.getTime() + 8 * 60 * 60 * 1000);

            let bjtimefinal = "";
            bjtimefinal += beijingDate.getDate();
            if (bjtimefinal.length == 1) {
                bjtimefinal = "0" + bjtimefinal;
            }

            let bjtimehour = "";
            bjtimehour += beijingDate.getHours();
            if (bjtimehour.length == 1) {
                bjtimehour = "0" + bjtimehour;
            }
            bjtimefinal += bjtimehour;

            let bjtimemin = "";
            bjtimemin += beijingDate.getMinutes();
            if (bjtimemin.length == 1) {
                bjtimemin = "0" + bjtimemin;
            }
            bjtimefinal += bjtimemin;

            callback(bjtimefinal);
        }

        function UNIXtoLocalTime(unixtime, callback) {
            const timestamp = unixtime;
            const date = new Date(timestamp * 1000);
            const beijingDate = new Date(date.toLocaleString());

            let bjtimefinal = "";
            bjtimefinal += beijingDate.getDate();
            if (bjtimefinal.length == 1) {
                bjtimefinal = "0" + bjtimefinal;
            }

            let bjtimehour = "";
            bjtimehour += beijingDate.getHours();
            if (bjtimehour.length == 1) {
                bjtimehour = "0" + bjtimehour;
            }
            bjtimefinal += bjtimehour;

            let bjtimemin = "";
            bjtimemin += beijingDate.getMinutes();
            if (bjtimemin.length == 1) {
                bjtimemin = "0" + bjtimemin;
            }
            bjtimefinal += bjtimemin;
            console.log(bjtimefinal);

            callback(bjtimefinal);
        }

        function WeatherCondition(data) {

        }

        function processSearchText(searchtext, callback) {
            //https://aviationweather.gov/cgi-bin/data/metar.php?ids=ZBAA
            //https://aviationweather.gov/data/metar/
            //https://aviationweather.gov/cgi-bin/data/metar.php?ids=ZBAA&hours=0&order=id%2C-obs&sep=true&format=json
            //https://aviationweather.gov/cgi-bin/data/taf.php?ids=ZBAA&format=json

            //METAR

            var text = 'https://www.aviationweather.gov/cgi-bin/data/metar.php?ids=' + searchtext + '&format=json';
            ajaxAPI(text, function (responseText) {
                responseText = responseText.substring(1, responseText.length - 1);
                var json = JSON.parse(responseText);
                console.log(responseText)
                //ICAO
                var finalICAO = "";
                for (let i = 0; i < json.icaoId.length; i++) {
                    console.log(jsonReading[json.icaoId[i]])
                    finalICAO += (jsonReading[json.icaoId[i]] + " ");
                };
                Alltext += "所选机场Metar播报, " + finalICAO + "。 ";
                //console.log(Alltext); 

                //通报时间
                var finalTime = "";
                var reportTimeInCode = json.rawOb.split(" ")[1];
                finalTime += (jsonReading[reportTimeInCode[0]] + " ");
                finalTime += (jsonReading[reportTimeInCode[1]] + ", ");
                finalTime += (jsonReading[reportTimeInCode[2]] + " ");
                finalTime += (jsonReading[reportTimeInCode[3]] + " ");
                finalTime += (jsonReading[reportTimeInCode[4]] + " ");
                finalTime += (jsonReading[reportTimeInCode[5]] + ", ");
                finalTime += (jsonReading[reportTimeInCode[6]] + " ");
                finalTime += "Time ";
                Alltext += "通报UTC时煎, " + finalTime + "。 ";

                //通报北京时间
                var finalBeijingTime = "";
                var reportBeijingTimeInCode = json.reportTime;
                UTCtoCST(reportBeijingTimeInCode, function (bjtime) {
                    for (let i = 0; i < bjtime.length; i++) {
                        console.log(jsonReading[bjtime[i]])
                        finalBeijingTime += (jsonReading[bjtime[i]] + " ");
                        if (i == 1) {
                            finalBeijingTime += ", ";
                        }
                    };
                    finalBeijingTime += "北京时 ";
                    Alltext += "通报北京时间, " + finalBeijingTime + "。 ";
                })


                //风
                var finalWind = "";
                var windir = "" + json.wdir;
                if (windir == "VRB") {
                    finalWind += "风向不定。";
                } else {
                    finalWind += "风向，";
                    if (windir.length == 1) {
                        finalWind += (jsonReading["0"] + " ");
                        finalWind += (jsonReading["0"] + " ");
                    }
                    if (windir.length == 2) {
                        finalWind += (jsonReading["0"] + " ");
                    }
                    for (let i = 0; i < windir.length; i++) {
                        console.log(jsonReading[windir[i]])
                        finalWind += (jsonReading[windir[i]] + " ");
                    };
                    finalWind += "度。 ";
                }

                var winddirall = json.rawOb.split(" ");
                for (var i = 0; i < winddirall.length; i++) {
                    let len = winddirall[i].length;
                    if (winddirall[i][len - 3] == "M" && winddirall[i][len - 2] == "P" && winddirall[i][len - 1] == "S") {
                        let j = i + 1;
                        if (j >= winddirall.length) { console.log(j); break; }
                        if (winddirall[j].length != 7) { console.log(j); continue; }
                        if (winddirall[j][3] == "V" && winddirall[j].length == 7) {
                            finalWind += ("具体风向， ");
                            for (let k = 0; k <= 2; k++) {
                                console.log(jsonReading[winddirall[j][k]]);
                                finalWind += (jsonReading[winddirall[j][k]] + " ");
                            }
                            finalWind += ("度，到， ");
                            for (let k = 4; k <= 6; k++) {
                                console.log(jsonReading[winddirall[j][k]]);
                                finalWind += (jsonReading[winddirall[j][k]] + " ");
                            }
                            finalWind += ("度。");
                        }
                    }
                }
                console.log(finalWind);

                finalWind += "风速, ";
                var windspeedMPS = "" + Math.round(json.wspd / 2);
                if (windspeedMPS < 10) {
                    finalWind += (jsonReading["0"] + " ");
                }
                for (let i = 0; i < windspeedMPS.length; i++) {
                    console.log(jsonReading[windspeedMPS[i]])
                    finalWind += (jsonReading[windspeedMPS[i]] + " ");
                };




                if (json.wgst == null || json.wgst == 0) {

                } else {
                    finalWind += "米秒。 阵风， ";
                    var windGspeedMPS = "" + Math.round(json.wgst / 2);
                    if (windGspeedMPS < 10) {
                        finalWind += (jsonReading["0"] + " ");
                    }
                    for (let i = 0; i < windGspeedMPS.length; i++) {
                        console.log(jsonReading[windGspeedMPS[i]])
                        finalWind += (jsonReading[windGspeedMPS[i]] + " ");
                    };
                }

                Alltext += (finalWind + "米秒。");

                //CAVOK
                for (var i = 2; i < winddirall.length; i++) {
                    if(winddirall[i] == "CAVOK"){
                        console.log("CAVOK");
                        Alltext += "好天气，CAVOK。";
                    }
                }

                //天气现象
                var wxString = json.wxString;
                var finalwxs = "";
                if (wxString != null) {
                    var wxarr = wxString.split(" ");
                    for (let i = 0; i < wxarr.length; i++) {
                        if (wxarr[i].length == 2) {
                            console.log(jsonweatherphen[wxarr[i]]);
                            finalwxs += jsonweatherphen[wxarr[i]] + "。";
                        } else if (wxarr[i].length == 3) {
                            var str = wxarr[i][1] + wxarr[i][2];
                            finalwxs += (jsonweathercondition[wxarr[i][0]] + jsonweatherphen[str] + "。");
                            console.log(finalwxs);
                        } else if (wxarr[i].length == 4) {
                            var str1 = wxarr[i][0] + wxarr[i][1];
                            var str2 = wxarr[i][2] + wxarr[i][3];
                            finalwxs += (jsonweathercondition[str1] + jsonweatherphen[str2] + "。");
                            console.log(finalwxs);
                        }
                    }
                }
                Alltext += finalwxs;

                //云底高
                var finalcloud = "";
                for (var i = 2; i < winddirall.length; i++) {
                    if(winddirall[i].includes("FEW")){
                        var strcloud = winddirall[i].substring(3,6);
                        var ncloud = parseInt(strcloud) * 30;
                        strcloud = "" + ncloud;
                        if(strcloud.length == 2){
                            strcloud = "0" + strcloud;
                        }
                        finalcloud += "少云，云底高，";
                        for (let j = 0; j < strcloud.length; j++) {
                            console.log(jsonReading[strcloud[j]])
                            finalcloud += (jsonReading[strcloud[j]] + " ");
                        };
                        finalcloud += "米。";
                        console.log(finalcloud);
                    }else if(winddirall[i].includes("SCT")){
                        var strcloud = winddirall[i].substring(3,6);
                        var ncloud = parseInt(strcloud) * 30;
                        strcloud = "" + ncloud;
                        if(strcloud.length == 2){
                            strcloud = "0" + strcloud;
                        }
                        finalcloud += "疏云，云底高，";
                        for (let j = 0; j < strcloud.length; j++) {
                            console.log(jsonReading[strcloud[j]])
                            finalcloud += (jsonReading[strcloud[j]] + " ");
                        };
                        finalcloud += "米。";
                        console.log(finalcloud);
                    }else if(winddirall[i].includes("BKN")){
                        var strcloud = winddirall[i].substring(3,6);
                        var ncloud = parseInt(strcloud) * 30;
                        strcloud = "" + ncloud;
                        if(strcloud.length == 2){
                            strcloud = "0" + strcloud;
                        }
                        finalcloud += "多云，云底高，";
                        for (let j = 0; j < strcloud.length; j++) {
                            console.log(jsonReading[strcloud[j]])
                            finalcloud += (jsonReading[strcloud[j]] + " ");
                        };
                        finalcloud += "米。";
                        console.log(finalcloud);
                    }else if(winddirall[i].includes("OVC")){
                        var strcloud = winddirall[i].substring(3,6);
                        var ncloud = parseInt(strcloud) * 30;
                        strcloud = "" + ncloud;
                        if(strcloud.length == 2){
                            strcloud = "0" + strcloud;
                        }
                        finalcloud += "阴天，满天云，云底高，";
                        for (let j = 0; j < strcloud.length; j++) {
                            console.log(jsonReading[strcloud[j]])
                            finalcloud += (jsonReading[strcloud[j]] + " ");
                        };
                        finalcloud += "米。";
                        console.log(finalcloud);
                    }else if(winddirall[i].includes("NSC")){
                        finalcloud += "云层无显著影响。";
                        console.log(finalcloud);
                    }else{
                        continue;
                    }
                }
                Alltext += finalcloud;

                //能见度
                var finalvisib = "能见度，";
                var visib = "" + json.visib;
                if (visib == "6+") {
                    Alltext += ("能见度，大于" + jsonReading["1"] + " " + jsonReading["0"] + "千米。 ");
                } else {
                    visib = "" + Math.round(json.visib * 1.6) + "+";
                    if (visib < 50) {
                        Alltext += ("能见度，小于" + jsonReading["5"] + " " + jsonReading["0"] + "米。 ");
                    } else {
                        for (let i = 0; i < visib.length; i++) {
                            console.log(jsonReading[visib[i]])
                            finalvisib += (jsonReading[visib[i]] + " ");
                        };
                        Alltext += (finalvisib + "米。 ");
                    }
                }

                //温度
                var finaltem = "温度，";
                var temp = "" + json.temp;
                var flagtemp = 0;
                if (temp.length == 1) { finaltem += (jsonReading["0"] + " "); }
                else if (temp.length == 2 && temp[0] == "-") { flagtemp = 1; }
                for (let i = 0; i < temp.length; i++) {
                    console.log(jsonReading[temp[i]]);
                    if (flagtemp == 1 && i == 1) { finaltem += (jsonReading["0"] + " "); }
                    finaltem += (jsonReading[temp[i]] + " ");
                };
                Alltext += (finaltem + "度。 ");

                //湿度
                var finaldewp = "露点，";
                var flagdewp = 0;
                var dewp = "" + json.dewp;
                if (dewp.length == 1) { finaldewp += (jsonReading["0"] + " "); }
                else if (dewp.length == 2 && dewp[0] == "-") { flagdewp = 1; }
                for (let i = 0; i < dewp.length; i++) {
                    console.log(jsonReading[dewp[i]])
                    if (flagdewp == 1 && i == 1) { finaldewp += (jsonReading["0"] + " "); }
                    finaldewp += (jsonReading[dewp[i]] + " ");
                };
                Alltext += (finaldewp + "度。 ");

                //气压
                var finalaltim = "修正海压，";
                var altim = "" + json.altim;
                for (let i = 0; i < altim.length; i++) {
                    console.log(jsonReading[altim[i]])
                    finalaltim += (jsonReading[altim[i]] + " ");
                };
                Alltext += (finalaltim + "。 ");
                console.log(Alltext);

                document.getElementById('ReadText').innerText = "\n\n\n\n\n\n\n\n" + Alltext + "\n\n\n\n";
                callback("\n\n\n\n\n\n\n\n" + Alltext + "\n\n\n\n", searchtext);
            });




        }
        processSearchText(RequestAirport, function (metarall, searchtext) {
            //TAF
            var texttaf = "https://aviationweather.gov/cgi-bin/data/taf.php?ids=" + searchtext + "&format=json";

            var tafall = "";
            tafall += "所选机场TAF播报。 ";


            ajaxAPI(texttaf, function (responseTexttaf) {
                responseTexttaf = responseTexttaf.substring(1, responseTexttaf.length - 1);
                var jsontaf = JSON.parse(responseTexttaf);

                console.log("taftaf");

                //有效时间
                var taffinaltime = "";
                UNIXtoLocalTime(jsontaf.validTimeFrom, function (timestd) {
                    console.log(timestd);
                    taffinaltime += "TAF有效时煎，";
                    for (let i = 0; i < timestd.length; i++) {
                        console.log(jsonReading[timestd[i]])
                        taffinaltime += (jsonReading[timestd[i]] + " ");
                        if (i == 1) {
                            taffinaltime += ", ";
                        }
                    }
                    taffinaltime += "北京时，到，";

                })

                UNIXtoLocalTime(jsontaf.validTimeTo, function (timestd) {
                    console.log(timestd);
                    for (let i = 0; i < timestd.length; i++) {
                        console.log(jsonReading[timestd[i]])
                        taffinaltime += (jsonReading[timestd[i]] + " ");
                        if (i == 1) {
                            taffinaltime += ", ";
                        }
                    }
                    taffinaltime += "北京时。";
                })

                tafall += taffinaltime;

                //预报温度
                var taffinaltemp = "";
                var timemax = jsontaf.fcsts[0].temp[1][0];
                var timemin = jsontaf.fcsts[0].temp[1][1];

                UNIXtoLocalTime(timemax.validTime, function (timestd) {
                    console.log(timestd);

                    taffinaltemp += "预计，最高温度，";

                    var sfctempmax = "" + timemax.sfcTemp;
                    var flagtemp = 0;
                    if (sfctempmax.length == 1) { taffinaltemp += (jsonReading["0"] + " "); }
                    else if (sfctempmax.length == 2 && sfctempmax[0] == "-") { flagtemp = 1; }
                    for (let i = 0; i < sfctempmax.length; i++) {
                        console.log(jsonReading[sfctempmax[i]]);
                        if (flagtemp == 1 && i == 1) { taffinaltemp += (jsonReading["0"] + " "); }
                        taffinaltemp += (jsonReading[sfctempmax[i]] + " ");
                    };
                    taffinaltemp += "度，在，";

                    for (let i = 0; i < timestd.length; i++) {
                        console.log(jsonReading[timestd[i]]);
                        taffinaltemp += (jsonReading[timestd[i]] + " ");
                        if (i == 1) {
                            taffinaltemp += ", ";
                        }
                    }
                    taffinaltemp += "北京时，时达到。";
                })

                UNIXtoLocalTime(timemin.validTime, function (timestd) {
                    console.log(timestd);

                    taffinaltemp += "最低温度，";
                    var sfctempmax = "" + timemin.sfcTemp;

                    var flagtemp = 0;
                    if (sfctempmax.length == 1) { taffinaltemp += (jsonReading["0"] + " "); }
                    else if (sfctempmax.length == 2 && sfctempmax[0] == "-") { flagtemp = 1; }
                    for (let i = 0; i < sfctempmax.length; i++) {
                        console.log(jsonReading[sfctempmax[i]]);
                        if (flagtemp == 1 && i == 1) { taffinaltemp += (jsonReading["0"] + " "); }
                        taffinaltemp += (jsonReading[sfctempmax[i]] + " ");
                    };

                    taffinaltemp += "度，在，";

                    for (let i = 0; i < timestd.length; i++) {
                        console.log(jsonReading[timestd[i]])
                        taffinaltemp += (jsonReading[timestd[i]] + " ");
                        if (i == 1) {
                            taffinaltemp += ", ";
                        }
                    }
                    taffinaltemp += "北京时，时达到。";
                })
                tafall += taffinaltemp;



                //风
                var finalWind = "";
                console.log(finalWind);
                var windir = "" + jsontaf.fcsts[0].wdir;
                if (windir == "VRB") {
                    finalWind += "风向不定。";
                } else {
                    finalWind += "风向，";
                    if (windir.length == 1) {
                        finalWind += (jsonReading["0"] + " ");
                        finalWind += (jsonReading["0"] + " ");
                    }
                    if (windir.length == 2) {
                        finalWind += (jsonReading["0"] + " ");
                    }
                    for (let i = 0; i < windir.length; i++) {
                        console.log(jsonReading[windir[i]])
                        finalWind += (jsonReading[windir[i]] + " ");
                    };
                    finalWind += "度。 ";
                }
                console.log(finalWind)

                var winddirall = jsontaf.rawTAF.split(" ");
                console.log(winddirall)
                for (var i = 0; i < winddirall.length; i++) {
                    let len = winddirall[i].length;
                    if (winddirall[i][len - 3] == "M" && winddirall[i][len - 2] == "P" && winddirall[i][len - 1] == "S") {
                        var j = i + 1;
                        if (j >= winddirall.length) { console.log(j); break; }
                        if (winddirall[j].length < 7 || winddirall[j].length > 7) { console.log("aaa" + winddirall[j].length); continue; }
                        if (winddirall[j][3] == "V" && winddirall[j].length == 7) {
                            finalWind += ("具体风向， ");
                            for (let k = 0; k <= 2; k++) {
                                console.log(jsonReading[winddirall[j][k]]);
                                finalWind += (jsonReading[winddirall[j][k]] + " ");
                            }
                            finalWind += ("度，到， ");
                            for (let k = 4; k <= 6; k++) {
                                console.log(jsonReading[winddirall[j][k]]);
                                finalWind += (jsonReading[winddirall[j][k]] + " ");
                            }
                            finalWind += ("度。");
                        }
                    }
                }

                console.log(finalWind);
                finalWind += "风速, ";
                var windspeedMPS = "" + Math.round(jsontaf.fcsts[0].wspd / 2);
                console.log(windspeedMPS)
                if (windspeedMPS < 10) {
                    finalWind += (jsonReading["0"] + " ");
                }
                for (let i = 0; i < windspeedMPS.length; i++) {
                    console.log(jsonReading[windspeedMPS[i]])
                    finalWind += (jsonReading[windspeedMPS[i]] + " ");
                };

                console.log(jsontaf.fcsts[0].wgst);
                if (jsontaf.fcsts[0].wgst == null || jsontaf.fcsts[0].wgst == 0) {

                } else {
                    finalWind += "米秒。 阵风， ";
                    var windGspeedMPS = "" + Math.round(jsontaf.fcsts[0].wgst / 2);
                    if (windGspeedMPS < 10) {
                        finalWind += (jsonReading["0"] + " ");
                    }
                    for (let i = 0; i < windGspeedMPS.length; i++) {
                        console.log(jsonReading[windGspeedMPS[i]])
                        finalWind += (jsonReading[windGspeedMPS[i]] + " ");
                    };
                }
                console.log(finalWind);
                tafall += (finalWind + "米秒。");

                //CAVOK
                for (var i = 0; i < winddirall.length; i++) {
                    if(winddirall[i] == "CAVOK"){
                        console.log("CAVOK");
                        tafall += "好天气，CAVOK。";
                    }
                }

                //天气现象
                var wxString = jsontaf.fcsts[0].wxString;
                var finalwxs = "";
                if (wxString != null) {
                    var wxarr = wxString.split(" ");
                    for (let i = 0; i < wxarr.length; i++) {
                        if (wxarr[i].length == 2) {
                            console.log(jsonweatherphen[wxarr[i]]);
                            finalwxs += jsonweatherphen[wxarr[i]] + "。";
                        } else if (wxarr[i].length == 3) {
                            var str = wxarr[i][1] + wxarr[i][2];
                            finalwxs += (jsonweathercondition[wxarr[i][0]] + jsonweatherphen[str] + "。");
                            console.log(finalwxs);
                        } else if (wxarr[i].length == 4) {
                            var str1 = wxarr[i][0] + wxarr[i][1];
                            var str2 = wxarr[i][2] + wxarr[i][3];
                            finalwxs += (jsonweathercondition[str1] + jsonweatherphen[str2] + "。");
                            console.log(finalwxs);
                        }
                    }
                }
                tafall += finalwxs;

                //云底高
                var finalcloud = "";
                for (var i = 2; i < winddirall.length; i++) {
                    if(winddirall[i].includes("FEW")){
                        var strcloud = winddirall[i].substring(3,6);
                        var ncloud = parseInt(strcloud) * 30;
                        strcloud = "" + ncloud;
                        if(strcloud.length == 2){
                            strcloud = "0" + strcloud;
                        }
                        finalcloud += "少云，云底高，";
                        for (let j = 0; j < strcloud.length; j++) {
                            console.log(jsonReading[strcloud[j]])
                            finalcloud += (jsonReading[strcloud[j]] + " ");
                        };
                        finalcloud += "米。";
                        console.log(finalcloud);
                    }else if(winddirall[i].includes("SCT")){
                        var strcloud = winddirall[i].substring(3,6);
                        var ncloud = parseInt(strcloud) * 30;
                        strcloud = "" + ncloud;
                        if(strcloud.length == 2){
                            strcloud = "0" + strcloud;
                        }
                        finalcloud += "疏云，云底高，";
                        for (let j = 0; j < strcloud.length; j++) {
                            console.log(jsonReading[strcloud[j]])
                            finalcloud += (jsonReading[strcloud[j]] + " ");
                        };
                        finalcloud += "米。";
                        console.log(finalcloud);
                    }else if(winddirall[i].includes("BKN")){
                        var strcloud = winddirall[i].substring(3,6);
                        var ncloud = parseInt(strcloud) * 30;
                        strcloud = "" + ncloud;
                        if(strcloud.length == 2){
                            strcloud = "0" + strcloud;
                        }
                        finalcloud += "多云，云底高，";
                        for (let j = 0; j < strcloud.length; j++) {
                            console.log(jsonReading[strcloud[j]])
                            finalcloud += (jsonReading[strcloud[j]] + " ");
                        };
                        finalcloud += "米。";
                        console.log(finalcloud);
                    }else if(winddirall[i].includes("OVC")){
                        var strcloud = winddirall[i].substring(3,6);
                        var ncloud = parseInt(strcloud) * 30;
                        strcloud = "" + ncloud;
                        if(strcloud.length == 2){
                            strcloud = "0" + strcloud;
                        }
                        finalcloud += "阴天，满天云，云底高，";
                        for (let j = 0; j < strcloud.length; j++) {
                            console.log(jsonReading[strcloud[j]])
                            finalcloud += (jsonReading[strcloud[j]] + " ");
                        };
                        finalcloud += "米。";
                        console.log(finalcloud);
                    }else if(winddirall[i].includes("NSC")){
                        finalcloud += "云层无显著影响。";
                        console.log(finalcloud);
                    }else{
                        continue;
                    }
                }
                tafall += finalcloud;

                //能见度
                var finalvisib = "能见度，";
                var visib = "" + jsontaf.fcsts[0].visib;
                var nvis = jsontaf.fcsts[0].visib;
                console.log(visib);
                if (visib == "6+") {
                    tafall += ("能见度，大于" + jsonReading["1"] + " " + jsonReading["0"] + "千米。 ");
                    console.log(tafall);
                } else {
                    nvis = nvis * 1.6;
                    visib = "" + nvis;
                    if (nvis < 0.05) {
                        tafall += ("能见度，小于" + jsonReading["5"] + " " + jsonReading["0"] + "米。 ");
                        console.log(tafall);
                    } else if (nvis < 0.8) {
                        nvis = nvis * 10;
                        nvis = nvis * 2;
                        nvis = Math.round(nvis);
                        nvis = nvis / 2;
                        nvis = nvis * 100;
                        console.log(nvis);

                        visib = "" + nvis;

                        for (let i = 0; i < visib.length; i++) {
                            console.log(jsonReading[visib[i]])
                            finalvisib += (jsonReading[visib[i]] + " ");
                        };
                        tafall += (finalvisib + "米。 ");
                        console.log(tafall);
                    } else if (nvis < 5) {
                        nvis = nvis * 10;
                        nvis = Math.round(nvis);
                        nvis = nvis * 100;
                        console.log(nvis);

                        visib = "" + nvis;

                        for (let i = 0; i < visib.length; i++) {
                            console.log(jsonReading[visib[i]])
                            finalvisib += (jsonReading[visib[i]] + " ");
                        };
                        tafall += (finalvisib + "米。 ");
                        console.log(tafall);
                    } else {
                        nvis = Math.round(nvis);
                        nvis = nvis * 1000;
                        visib = "" + nvis;

                        for (let i = 0; i < visib.length; i++) {
                            console.log(jsonReading[visib[i]])
                            finalvisib += (jsonReading[visib[i]] + " ");
                        };
                        tafall += (finalvisib + "米。 ");
                        console.log(tafall);
                    }
                }

                

                //Output

                console.log(tafall);

                document.getElementById('ReadText').innerText = metarall + tafall;

            })
        });
    </script>
</body>